---
import Layout from './Layout.astro';
import Card from '../components/Card.astro';
import Image from '../components/Image.astro';
import Dialog from '../components/Dialog.astro';
interface Props {
  title: string;
  cena: string;
  barvy: string;
  kusu: string;
}
let { title, cena, barvy, kusu } = Astro.props;
let pocet = kusu.match(/[^\s,]+/g);
const list = barvy.match(/[^\s,]+/g);
---

<Layout title={title}>
  <Dialog produkt={title} />
  <div class="image"><Image title={title} /></div>
  <h1 class="text-gradient">{title}</h1>
  <p>Cena: {cena}</p><br />
  <p>
    Barva:
    <button class="color1"></button>
    <button class="color2"></button>
    <button class="color3"></button>
    <button class="color4"></button>
  </p>

  <p class="dostupnost"></p>
  <p class="k">
    <button>Objednat</button>
  </p>

  <div class="cards">
    <h2>Doporučujeme</h2>
    <ul role="list" class="link-card-grid">
      <Card title="Antistresová houbička" />
      <Card title="Dinosauřík" />
      <Card title="Mini tučňák" />
    </ul>
    <h2>Skladem</h2>
    <ul role="list" class="link-card-grid">
      <Card title="Králíček" />
      <Card title="Kuře" />
      <Card title="Mini tučňák" />
    </ul>
  </div>
</Layout>
<style>
  .dostupnost {
    @media (width<600px) {
      margin: 0;
    }
  }
</style>
<script define:vars={{ barvy, title, pocet, list }}>
  let currentColor = 1;
  for (let index = 1; index <= list.length; index++) {
    let button = document.querySelector(`p button:nth-child(${index})`);
    button.style.backgroundColor = list[index - 1];
    button.style.display = 'inline';
    if (pocet[0] == '0') {
      document.querySelector('.dostupnost').innerText = 'Vyprodáno';
      document.querySelector('.dostupnost').background = 'red';
    } else {
      document.querySelector('.dostupnost').innerText =
        `Skladem (${pocet[0]}ks)`;
    }
    button.addEventListener('click', () => {
      img.src = `/${title}/${index}/1.jpg`;
      console.log(pocet);
      currentColor = index;
      if (pocet[index - 1] == '0') {
        document.querySelector('.dostupnost').innerText = 'Vyprodáno';
        document.querySelector('.dostupnost').background = 'red';
        console.log(pocet[index - 1]);
      } else {
        document.querySelector('.dostupnost').innerText =
          `Skladem (${pocet[index - 1]}ks)`;
      }
    });
  }

  const btn = document.querySelector('.k button');
  btn.addEventListener('click', () => {
    Objednávka(title);
  });

  const btn1 = document.querySelector('.p');
  const btn2 = document.querySelector('.d');
  const btn3 = document.querySelector('.t');
  const img = document.getElementById('img');
  btn1.addEventListener('click', () => {
    img.src = `/${title}/${currentColor}/1.jpg`;
    btn1.style.backgroundPosition = 'right';
    btn2.style.backgroundPosition = 'left';
    btn3.style.backgroundPosition = 'left';
  });
  btn2.addEventListener('click', () => {
    img.src = `/${title}/${currentColor}/2.jpg`;
    btn1.style.backgroundPosition = 'left';
    btn2.style.backgroundPosition = 'right';
    btn3.style.backgroundPosition = 'left';
  });
  btn3.addEventListener('click', () => {
    img.src = `/${title}/${currentColor}/3.jpg`;
    btn1.style.backgroundPosition = 'left';
    btn2.style.backgroundPosition = 'left';
    btn3.style.backgroundPosition = 'right';
  });
  const dialog = document.getElementById('dialog');
  const paragraph = document.getElementById('paragraph');
  const pojem = document.getElementById('produkt');
  let barva = document.getElementById('barva');

  function Objednávka(produkt) {
    dialog.showModal();
    barva.value = list[currentColor - 1];
    pojem.value = produkt;
    console.log(pojem.value, barva.value);
    paragraph.innerHTML = produkt;
  }
</script>

<style>
  .dostupnost {
    font-size: larger;
    background: green;
    display: inline;
    padding: 10px;
    margin-left: 250px;
  }
  button[class*='color'] {
    display: none;
    background-size: 400%;
    transition: 1s;
    margin: 0 2px;
    border-radius: 50%;
    width: 15px;
    height: 15px;
    border: rgb(137, 137, 137) solid 2px;
  }
  button {
    border: none;
    background: none;
  }
  button:hover {
    cursor: pointer;
  }
  .cards {
    max-width: 1000px;
    padding-left: 200px;
    @media (width<600px) {
      padding-left: 20px;
    }
  }

  p.k {
    display: flex;
    justify-content: end;
    & button {
      margin: 30px;
      font-size: large;
      border-radius: 8px;
      color: rgb(5, 9, 17);
      transition: 1s;
      background-size: 400%;
      background-position: right;
      padding: 30px 50px;
      background-image: linear-gradient(
        45deg,
        rgb(0, 135, 41),
        rgb(119, 255, 155),
        rgb(206, 206, 206),
        rgb(196, 196, 255)
      );
    }
    & button:hover {
      background-position: left;
    }
  }

  section {
    flex-direction: column;
    display: flex;
    margin: 20px;
    float: left;
  }
  .image {
    width: 50%;
    padding: 10px;
    margin-left: 200px;
    border-radius: 10px;
    margin-right: 50px;
    float: left;
    background: #f2c6c6;
    position: relative;

    @media (width < 600px) {
      float: none;
      display: block;
      width: 90%;
      margin: 0;
    }
  }
  img {
    border-radius: 10px;
    margin-top: 3px;
  }
  p {
    color: white;
    font-size: 2rem;
    margin: 0 60px;
  }
  h2 {
    color: aliceblue;
  }
  quantity-input {
    background: white;
    padding: 10px;
    border-radius: 8px;
    width: max-content;
    & * {
      padding: 5px;
    }
  }
</style>
